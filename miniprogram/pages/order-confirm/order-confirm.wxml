<!-- order-confirm.wxml -->
<view class="order-confirm-container">
  <!-- 赛事信息 -->
  <view class="match-info">
    <view class="match-title">{{matchInfo.name}}</view>
    <view class="match-time">{{matchTimeStr}}</view>
    <view class="match-location">{{matchInfo.location}}</view>
  </view>
  <!-- 购票规则 -->
  <view class="purchase-rules">
    <view class="rules-text">每个账号限购2张，按付款顺序配票，优先连坐配票。若无连坐，则随机分配座位。</view>
    <view class="policy-list">
      <view class="policy-item">
        <image class="policy-icon" src="../../assets/no_quit.png" mode="aspectFill"></image>
        <text class="policy-text">不支持退</text>
      </view>
      <view class="policy-item">
        <image class="policy-icon" src="../../assets/shiming.png" mode="aspectFill"></image>
        <text class="policy-text">实名制购票和入场</text>
      </view>
      <view class="policy-item">
        <image class="policy-icon" src="../../assets/dianzi.png" mode="aspectFill"></image>
        <text class="policy-text">电子票</text>
      </view>
    </view>
  </view>
  <!-- 观赛人信息 -->
  <view class="attendee-section">
    <view class="attendee-list">
      <view class="attendee-item" wx:for="{{attendeeList}}" wx:key="index">
        <view class="attendee-remove" bindtap="removeAttendee" data-index="{{index}}">
          <image class="remove-icon" src="../../assets/delete.png" mode="aspectFit"></image>
        </view>
        <view class="attendee-info">
          <view class="attendee-name">{{item.name}}</view>
          <view class="attendee-id">证件号 {{item.idNumber}}</view>
        </view>
      </view>
    </view>
    <view wx:if="{{type !== 'gift'}}" class="add-attendee" bindtap="addAttendee">
      <image class="add-icon" src="../../assets/add.png" mode="aspectFit"></image>
      <text class="add-text">新增</text>
    </view>
  </view>
  <!-- 购票须知提示 -->
  <view class="notice-tip">
    <view class="radio-container">
      <radio color="#3461fd" class="notice-radio" checked="{{hasReadNotices}}" bindtap="onNoticeRadioChange" />
      <text class="tip-text">我已阅读</text>
      <text class="notice-link" bindtap="openPurchaseNotice">《购票须知》</text>
      <text class="notice-link" bindtap="openSecurityNotice">《安检须知》</text>
      <text class="notice-link" bindtap="openEntryNotice">《入场须知》</text>
    </view>
  </view>
  <!-- 底部购买区域 -->
  <view class="bottom-bar">
    <view class="price-info">
      <text class="price-label">¥</text>
      <text class="price-value">{{totalPrice}}</text>
    </view>
    <view class="buy-button {{isPurchasing ? 'buy-button-disabled' : ''}}" bindtap="confirmPurchase">
      {{isPurchasing ? '处理中...' : '立即购买'}}
    </view>
  </view>
  <!-- 添加观赛人弹窗 -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="closeModal">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">添加观赛人</text>
      </view>
      <view class="form-content">
        <!-- 姓名输入 -->
        <view class="form-item">
          <text class="form-label">姓名</text>
          <input class="form-input" placeholder="请输入姓名" value="{{newAttendee.name}}" data-field="name" bindinput="onInputChange" focus="{{false}}" />
        </view>
        <!-- 证件类型选择 -->
        <view class="form-item">
          <text class="form-label">证件类型</text>
          <picker range="{{idTypeOptions}}" range-key="label" value="{{currentIdTypeIndex}}" bindchange="onIdTypeChange">
            <view class="form-picker">
              <view class="picker-content">
                <text class="picker-text">{{idTypeOptions[currentIdTypeIndex].label || '身份证'}}</text>
                <image class="picker-arrow" src="../../assets/arrow-right.png" mode="widthFix" />
              </view>
            </view>
          </picker>
        </view>
        <!-- 证件号输入 -->
        <view class="form-item">
          <text class="form-label">证件号</text>
          <input class="form-input" placeholder="请输入证件号" value="{{newAttendee.idNumber}}" data-field="idNumber" bindinput="onInputChange" focus="{{false}}" />
        </view>
        <!-- 电话号码输入 -->
        <view class="form-item">
          <text class="form-label">电话号码</text>
          <input class="form-input" placeholder="请输入电话号码" value="{{newAttendee.phone}}" data-field="phone" bindinput="onInputChange" type="number" focus="{{false}}" />
        </view>
      </view>
      <view class="modal-footer">
        <view class="modal-btn cancel-btn" bindtap="closeModal">取消</view>
        <view class="modal-btn confirm-btn" bindtap="confirmAddAttendee">确认</view>
      </view>
    </view>
  </view>
</view>